---
description: "Gu√≠a de desarrollo Backend (Laravel) para el MVP de Corral X"
alwaysApply: true
---

## üéØ ESTADO ACTUAL DEL PROYECTO

**MVP:** ‚úÖ 100% Completado  
**Tests Backend:** 155/155 pasando (100%)  
**Endpoints:** 26/26 operativos  
**Bugs Cr√≠ticos:** 0  
**√öltima actualizaci√≥n:** Diciembre 2025

---

## REGLAS FUNDAMENTALES DE COLABORACI√ìN

**IMPORTANTE: El usuario es el l√≠der del proyecto. El asistente debe:**

1. **SIEMPRE PREGUNTAR** antes de realizar cualquier acci√≥n
2. **NUNCA crear archivos nuevos** si es para editar c√≥digo existente
3. **SIEMPRE sugerir detalladamente** qu√© hacer y esperar aprobaci√≥n
4. **NUNCA hacer push a git** sin orden expl√≠cita del usuario
5. **El usuario tiene el mando** - el asistente sugiere, el usuario decide

**Flujo de trabajo:**
- Asistente: "Sugiero hacer X, ¬øquieres que proceda?"
- Usuario: "S√≠, hazlo" o "No, mejor Y"
- Asistente: Ejecuta solo lo aprobado

---

## üîÄ FLUJO DE TRABAJO CON GIT (OBLIGATORIO)

### Estrategia de Ramas

**CR√çTICO:** Este proyecto utiliza un flujo de trabajo estricto con dos ramas:

1. **`dev`** - Rama de pruebas/testing
   - Despliegue autom√°tico: `test.corralx.com`
   - Ambiente: `APP_DEBUG=true`
   - **SIEMPRE hacer push aqu√≠ primero**

2. **`main`** - Rama de producci√≥n
   - Despliegue autom√°tico: `corralx.com`
   - Ambiente: `APP_DEBUG=false`
   - **Solo merge cuando est√©s 100% seguro**

### Proceso OBLIGATORIO

**PASO 1: Desarrollo (SIEMPRE PRIMERO)**
```bash
# 1. Trabajar en dev
git checkout dev
git pull origin dev

# 2. Hacer cambios y commits
git add .
git commit -m "feat: descripci√≥n"

# 3. Push a dev (pruebas)
git push origin dev
# ‚úÖ Se despliega a test.corralx.com autom√°ticamente
```

**PASO 2: Verificaci√≥n en Pruebas**
- Probar en `test.corralx.com`
- Verificar que no hay errores
- Ejecutar tests: `php artisan test`
- Confirmar funcionalidad

**PASO 3: Merge a Producci√≥n (SOLO SI EST√ÅS SEGURO)**
```bash
# 1. Cambiar a main
git checkout main
git pull origin main

# 2. Merge desde dev
git merge dev

# 3. Push a main (producci√≥n)
git push origin main
# ‚úÖ Se despliega a corralx.com autom√°ticamente
```

### Reglas CR√çTICAS

‚ö†Ô∏è **NUNCA hacer push directo a `main` sin pasar por `dev`**

‚úÖ **Flujo correcto:**
1. Cambios ‚Üí `dev` ‚Üí Push ‚Üí Probar en `test.corralx.com`
2. Si todo OK ‚Üí Merge `dev` ‚Üí `main` ‚Üí Push ‚Üí Producci√≥n

‚ùå **Flujo incorrecto:**
- Push directo a `main` sin probar en `dev`
- Merge a `main` sin verificar en pruebas

### Control de Acceso

- **Admin (usuario):** Puede hacer push y merge a ambas ramas
- **Otros desarrolladores:** Solo push a `dev`, NO pueden tocar `main`

**El asistente debe:**
- Siempre hacer push a `dev` primero cuando el usuario lo solicite
- NUNCA sugerir push directo a `main`
- Recordar al usuario verificar en `test.corralx.com` antes de merge a `main`
- Solo hacer merge a `main` cuando el usuario expl√≠citamente lo solicite y confirme que est√° seguro

---

## Nuevo flujo de pedidos y entrega (sin pagos digitales)
- El backend debe proporcionar toda la l√≥gica para **coordinar** la transacci√≥n, pero **no procesa pagos**. El intercambio econ√≥mico ocurre fuera de la plataforma cuando comprador y vendedor se encuentran f√≠sicamente con el comprobante generado por CorralX.
- Endpoints m√≠nimos (ver detalles en `README.md` y `CICLO_COMPLETO_LOGIC_DETALLADA.md`):
  - `POST /api/orders` ‚Äì Crear pedido desde el chat (status inicial `pending`).
  - `GET /api/orders`, `GET /api/orders/{id}` ‚Äì Listar/detallar pedidos (filtros por rol/estado).
  - `PUT /api/orders/{id}/accept`, `/reject`, `/deliver`, `/cancel` ‚Äì Transiciones de estado.
  - `GET /api/orders/{id}/receipt` ‚Äì Obtener comprobante de venta (JSON con datos completos del encuentro).
  - `POST /api/orders/{id}/review` ‚Äì Calificaciones mutuas (comprador: producto + vendedor; vendedor: comprador).
- **Modelo `Order`**: contener campos para delivery (`delivery_method`, `pickup_location`, `pickup_address`, `delivery_address`, `delivery_cost`, `delivery_provider`, `delivery_tracking_number`), comprobante (`receipt_number`, `receipt_data`), fechas (`expected_pickup_date`, `actual_pickup_date`) y timestamps (`accepted_at`, `delivered_at`, `completed_at`).
- **M√©todos de delivery soportados** (validar en FormRequest):
  1. `buyer_transport` ‚Äì comprador lleva su transporte (requiere `pickup_location` y direcci√≥n si es ‚Äúother‚Äù).
  2. `seller_transport` ‚Äì vendedor entrega (requiere `delivery_address`, costo opcional).
  3. `external_delivery` ‚Äì servicio de terceros (requiere `delivery_address`, `delivery_provider`).
  4. `corralx_delivery` ‚Äì log√≠stica interna (requiere `delivery_address`, `delivery_provider` predefinido).
- `Order::accept()` debe:
  - Verificar ownership (el product pertenece al vendedor autenticado).
  - Generar `receipt_number` √∫nico (`CORRALX-{ORDER_ID}-{YYYYMMDD}`).
  - Llamar `generateReceiptData()` para consolidar datos de vendedor, comprador, finca, delivery, fechas y notas (se usa como contrato operativo en el encuentro f√≠sico).
  - Descontar `product.quantity` y marcar `product.status='sold'` si queda en cero.
- `markAsDelivered()` solo lo puede ejecutar el comprador; `complete()` se ejecuta autom√°ticamente cuando ambas partes ya enviaron sus reviews.
- **Controles recomendados (post-MVP, documentados para referencia futura):**
  - Confirmaci√≥n dual (vendedor puede validar o disputar la entrega dentro de X horas ‚Üí estado `under_review`).
  - Sistema de disputas con evidencias (fotos, notas).
  - Evidencia de entrega obligatoria para ciertos m√©todos (subir foto/comprobante firmado).
  - M√©tricas por m√©todo de delivery para IA Insights.
  - Notas internas del vendedor (campo privado).

---

## üîê M√≥dulo KYC / Verificaci√≥n de Identidad (MVP Backend)

### Objetivo
- Proveer un **KYC b√°sico y obligatorio** para el MVP que permita:
  - Captura y almacenamiento de fotos de:
    - Documento de identidad (frontal y opcional dorso).
    - Selfie.
    - Selfie sosteniendo el documento.
  - Gesti√≥n de un estado simple de verificaci√≥n:
    - `no_verified`, `pending`, `verified`, `rejected`.
- Mantener el dise√±o actual sin tablas redundantes:
  - El estado KYC y metadatos m√≠nimos se guardan en la tabla existente de `profiles` (o `users` si se decide expl√≠citamente), no en nuevas tablas complejas.
  - Para el MVP se prioriza la **C√©dula de Identidad venezolana (CI, V-/E-)** como documento de persona y el **RIF** de la hacienda ya capturado en onboarding como identificador fiscal del negocio.

### Dise√±o de datos (extensi√≥n de `profiles`)
- A√±adir una migraci√≥n que agregue los siguientes campos a `profiles`:
  - `kyc_status` (string, default `no_verified`).
    - Valores esperados: `no_verified`, `pending`, `verified`, `rejected`.
  - `kyc_rejection_reason` (text, nullable).
  - `kyc_document_type` (string, nullable) ‚Äì por ejemplo: `dni`, `pasaporte`, `cedula_ve`.
  - `kyc_document_number` (string, nullable).
  - `kyc_country_code` (string, nullable, ej. `VE`, `CO`).
  - Paths de im√°genes (todas `nullable`):
    - `kyc_doc_front_path` (string).
    - `kyc_doc_back_path` (string).
    - `kyc_selfie_path` (string).
    - `kyc_selfie_with_doc_path` (string).
  - Opcional a futuro:
    - `kyc_verified_at` (timestamp, nullable).
- En el modelo `Profile`:
  - M√©todo helper sugerido:
    ```php
    public function isKycVerified(): bool
    {
        return $this->kyc_status === 'verified';
    }
    ```

### Endpoints KYC (API REST)
- Namespace sugerido: `KycController` en `app/Http/Controllers/Profiles/` (o un namespace dedicado `Security/` seg√∫n se acuerde).
- Todas las rutas KYC deben ir bajo middleware `auth:sanctum`.
- Endpoints m√≠nimos:
  - `GET  /api/kyc/status`
    - Devuelve al menos:
      - `kyc_status`
      - `kyc_rejection_reason`
      - `has_document`, `has_selfie`, `has_selfie_with_doc`
      - Opcional: `kyc_document_type`, `kyc_country_code`, versi√≥n enmascarada de `kyc_document_number`.
  - `POST /api/kyc/start`
    - Inicializa o reinicia el flujo KYC:
      - Si `kyc_status` es `no_verified` o `rejected`, pasa a `pending`.
      - Puede recibir y guardar `document_type`, `document_number`, `country_code` si se desea capturar aqu√≠.
  - `POST /api/kyc/upload-document`
    - Request (multipart):
      - `front`: imagen requerida.
      - `back`: imagen opcional.
      - Opcionales: `document_type`, `document_number`, `country_code` (si no se enviaron en `/start`).
    - Guarda archivos en `storage/app/public/kyc/{profile_id}/doc_front.jpg` y `doc_back.jpg`.
    - Actualiza los paths y deja `kyc_status` en `pending`.
  - `POST /api/kyc/upload-selfie`
    - Request (multipart):
      - `selfie`: imagen requerida.
    - Guarda en `storage/app/public/kyc/{profile_id}/selfie.jpg`.
    - Actualiza `kyc_selfie_path`.
  - `POST /api/kyc/upload-selfie-with-doc`
    - Request (multipart):
      - `selfie_with_doc`: imagen requerida.
    - Guarda en `storage/app/public/kyc/{profile_id}/selfie_with_doc.jpg`.
    - Actualiza `kyc_selfie_with_doc_path`.

### Validaciones y seguridad KYC
- Validaci√≥n de archivos:
  - `image|mimes:jpeg,png,jpg|max:5120` (5 MB).
  - Rechazar si el archivo requerido no est√° presente.
- Acceso:
  - Solo el usuario autenticado puede subir/ver su propia informaci√≥n KYC.
  - No exponer rutas internas sin necesidad; preferir URLs completas cuando se env√≠en al frontend.
- Datos sensibles:
  - Evitar devolver `kyc_document_number` completo en las respuestas generales; usar m√°scaras cuando sea necesario.

### Flujo de revisi√≥n y aprobaci√≥n (MVP)
- Fase 1 (MVP): revisi√≥n **manual**, sin IA/OCR:
  - Un admin revisa las im√°genes KYC en un panel simple (o v√≠a herramientas internas).
  - Al aprobar/rechazar:
    - `kyc_status = 'verified'` o `kyc_status = 'rejected'`.
    - Si se rechaza, llenar `kyc_rejection_reason` con un mensaje claro para el usuario.
  - Esta l√≥gica puede vivir inicialmente en un controlador/admin simple o comandos de mantenimiento; el detalle de UI admin se puede posponer.

### Evoluci√≥n: KYC autom√°tico con IA (plan)
- Objetivo a corto/mediano plazo: que la decisi√≥n KYC sea **autom√°tica por defecto**, usando:
  - Datos estructurados ya disponibles (CI, RIF, perfil, haciendas).
  - Resultados de OCR (actualmente en el frontend) y reglas locales en backend.
  - Opcionalmente, un evaluador IA basado en **Gemini** para casos dudosos.
- Servicio sugerido:
  - `KycEvaluationService` (o similar) que reciba un ‚Äúpaquete KYC‚Äù con:
    - Datos de perfil (`first_name`, `last_name`, `ci_number`, fecha de nacimiento, etc.).
    - Datos del RIF (`rifNumber`, `businessName`, `address`).
    - Metadatos de archivos (`kyc_doc_front_path`, `kyc_selfie_path`, `kyc_selfie_with_doc_path`).
  - Aplica validaciones locales (formatos, coherencia persona‚Äìnegocio) y, si est√° configurada `GOOGLE_GEN_AI_KEY`, llama a Gemini para obtener:
    - `decision`: `verified`, `rejected` o `pending`.
    - `reasons`: lista de mensajes claros para el usuario/log.
  - Escribe la decisi√≥n final en `profiles.kyc_status` y `profiles.kyc_rejection_reason`.
- Restricciones de servicios:
  - No se a√±aden nuevos proveedores pagos de visi√≥n/biometr√≠a (AWS Rekognition, Vision API, etc.) en este plan.
  - Gemini se usa √∫nicamente como **motor de evaluaci√≥n sobre datos ya extra√≠dos**, nunca como reemplazo directo de OCR ni recibiendo im√°genes crudas desde el frontend.

### Contrato con Frontend (User / Profile endpoints)
- El endpoint que alimenta `UserProvider.getUserDetails()` en frontend debe incluir:
  - `kyc_status`
  - `kyc_rejection_reason`
  - Opcional: `kyc_document_type`, `kyc_country_code`.
- El endpoint `/api/profile` tambi√©n puede exponer estos campos cuando se vea el perfil propio, para que `ProfileScreen` muestre el estado de verificaci√≥n.

### Reglas de negocio relacionadas con KYC (backend)
- **Crear productos (`POST /api/products`)**:
  - Adem√°s de las validaciones actuales de ownership y ranch:
    - Es obligatorio exigir que el usuario tenga `profile.kyc_status === 'verified'` para publicar.
    - Se debe asumir que el `RIF` de la hacienda principal ya fue capturado y validado durante el onboarding (OnboardingPage2 + validaciones actuales de `tax_id` en backend).
  - Si la verificaci√≥n es obligatoria para publicar:
    - Responder con `403` o `422` y un mensaje claro:  
      ‚ÄúDebes completar la verificaci√≥n de identidad (KYC) antes de publicar productos.‚Äù
- Otros endpoints sensibles se pueden endurecer en fases posteriores reutilizando `Profile::isKycVerified()` en policies o middleware espec√≠ficos.

---

## üìÅ Estructura de Carpetas y Convenciones

### Controladores
- **Ubicaci√≥n:** `app/Http/Controllers`
- **Nomenclatura:** Singular + sufijo `Controller` (ej: `ProductController`)
- **Organizaci√≥n:** Por funcionalidad en subdirectorios
  - `Authenticator/AuthController.php`
  - `Profiles/ProfileController.php`
  - `Profiles/RanchController.php`
  - `Marketplace/ProductController.php`
  - `ChatController.php`

### Modelos
- **Ubicaci√≥n:** `app/Models`
- **Nomenclatura:** Singular PascalCase (ej: `Product`, `Ranch`)
- **Convenci√≥n:** Eloquent deduce tabla plural (Product ‚Üí products)
- **Relaciones:** Siempre definir en ambos lados (hasMany ‚Üî belongsTo)

### Factories y Seeders
- ‚úÖ **COMPLETADO:** Todos los factories con datos del mercado venezolano
- ‚úÖ **COMPLETADO:** Seeders con 683 pa√≠ses, 4,528 estados, 47,123 ciudades, 432 parroquias de Venezuela
- **Factories:** `database/factories/{Model}Factory.php`
- **Seeders:** `database/seeders/{Entity}Seeder.php`
- **Datos realistas:** Razas venezolanas, ubicaciones reales, nombres de haciendas t√≠picos

### Tests
- **Feature Tests:** `tests/Feature/{Module}ApiTest.php`
- **Unit Tests:** `tests/Unit/{Model}Test.php`
- **Estado actual:** 27/27 tests pasando (100%)

---

## üõ£Ô∏è Rutas y Endpoints (API REST)

### Autenticaci√≥n (`/api/auth/*`)
```php
POST   /api/auth/register           # Registro + token Sanctum
POST   /api/auth/login              # Login + token
POST   /api/auth/google             # Google OAuth
POST   /api/auth/logout (auth)      # Cierra sesi√≥n
GET    /api/auth/user (auth)        # Usuario actual
PUT    /api/auth/user (auth)        # Actualizar usuario
PUT    /api/auth/password (auth)    # Cambiar contrase√±a
```

### Perfiles (`/api/profile*`, `/api/profiles/*`)
```php
# Perfil propio (auth)
GET    /api/profile                 # Mi perfil completo con relaciones
PUT    /api/profile                 # Actualizar (firstName, lastName, bio, etc.)
POST   /api/profile/photo           # Subir foto (multipart) ‚úÖ Endpoint dedicado

# Perfil p√∫blico
GET    /api/profiles/{id}           # Ver perfil de otro usuario (limitado)

# Recursos del usuario
GET    /api/me/products              # Mis productos
GET    /api/me/ranches               # Mis haciendas
GET    /api/me/metrics               # M√©tricas agregadas

# Recursos p√∫blicos
GET    /api/profiles/{id}/ranches   # Haciendas de un perfil (p√∫blico)
```

### Haciendas (`/api/ranches/*`)
```php
GET    /api/ranches                 # Listar con filtros
POST   /api/ranches (auth)          # Crear hacienda
GET    /api/ranches/{id}            # Ver detalle
PUT    /api/ranches/{id} (auth)     # Actualizar (solo owner) ‚úÖ
DELETE /api/ranches/{id} (auth)     # Eliminar (solo owner, con validaciones) ‚úÖ
```

**Validaciones DELETE ranches:**
- ‚úÖ No eliminar hacienda con productos activos
- ‚úÖ No eliminar la √∫nica hacienda del perfil
- ‚úÖ Auto-promoci√≥n de otra hacienda como primary
- ‚úÖ Soft delete (recuperable)

### Productos (`/api/products/*`)
```php
# P√∫blicos
GET    /api/products                # Listar con filtros avanzados
GET    /api/products/{id}           # Detalle (incrementa views si no es owner)

# Protegidos (auth)
POST   /api/products                # Crear producto
PUT    /api/products/{id}           # Actualizar (solo owner del ranch)
DELETE /api/products/{id}           # Eliminar (solo owner del ranch)
```

**Filtros GET /api/products:**
- `type`, `breed`, `sex`, `purpose`, `weight_min`, `weight_max`
- `is_vaccinated`, `delivery_method`, `negotiable`, `status`
- `per_page` (default: 20)

### Chat (`/api/chat/*`) (auth)
```php
GET    /api/chat/conversations                  # Mis conversaciones
POST   /api/chat/conversations                  # Crear/iniciar chat
GET    /api/chat/conversations/{id}/messages    # Historial
POST   /api/chat/conversations/{id}/messages    # Enviar mensaje
POST   /api/chat/conversations/{id}/read        # Marcar le√≠dos
DELETE /api/chat/conversations/{id}             # Eliminar conversaci√≥n
```

### Favoritos y Rese√±as
```php
POST   /api/products/{id}/favorite              # Toggle favorito
DELETE /api/products/{id}/favorite
GET    /api/products/{id}/reviews               # Rese√±as del producto
POST   /api/products/{id}/reviews               # Crear rese√±a
GET    /api/ranches/{id}/reviews                # Rese√±as de hacienda
```

### Reportes
```php
POST   /api/reports (auth)          # Reportar (polim√≥rfico)
GET    /api/reports (auth)          # Mis reportes
GET    /api/admin/reports (admin)   # Pendientes (moderaci√≥n)
```

---

## üóÑÔ∏è Modelos, Relaciones y L√≥gica de Negocio

### User (Autenticaci√≥n)
```php
// Campos
id, name, email, password, google_id, role, completed_onboarding

// Relaciones
hasOne(Profile::class)

// L√≥gica
- Solo autenticaci√≥n, datos personales en Profile
```

### Profile (Datos Personales + Marketplace)
```php
// Campos clave
firstName, middleName, lastName, secondLastName
bio (‚â§500 caracteres) ‚úÖ
photo_users, date_of_birth, marital_status, sex, ci_number
user_type, is_verified, rating, ratings_count
accepts_calls, accepts_whatsapp, accepts_emails, whatsapp_number

// Relaciones
belongsTo(User::class)
hasMany(Ranch::class)
hasMany(Address::class)
hasMany(Phone::class)
hasOne(CiDocument::class)

// M√©todos √∫tiles
public function isVerified(): bool
public function fullName(): string
```

### Ranch (Haciendas)
```php
// Campos clave
name, legal_name, tax_id
business_description (‚â§1000)
specialization, certifications (json)
contact_hours, delivery_policy, return_policy
is_primary ‚úÖ auto-gestionado
accepts_orders, min_order_amount, max_delivery_distance_km
avg_rating, total_sales, last_sale_at

// Relaciones
belongsTo(Profile::class)
hasMany(Product::class)
hasOne(Address::class)
hasOne(Phone::class)
hasOne(RifDocument::class)

// L√≥gica de negocio ‚úÖ
- Al eliminar: verificar no tiene productos activos
- Al eliminar: verificar no es la √∫nica hacienda
- Al eliminar primary: auto-promover otra hacienda
- Soft delete (recuperable)
```

### Product (Ganado/Productos)
```php
// Campos clave
title, description, type, breed
age_months, quantity, price, currency
weight_avg_kg, weight_min_kg, weight_max_kg
sex, purpose, is_vaccinated
delivery_method, delivery_cost, delivery_radius_km
negotiable, status, views_count

// Relaciones
belongsTo(Ranch::class)
hasMany(ProductImage::class)
hasMany(Favorite::class)
hasMany(Review::class)
belongsToMany(Category::class)

// L√≥gica
- views_count se incrementa en show() si no es owner
- status por default: 'active'
- Validaci√≥n: ranch_id debe pertenecer al profile del usuario
```

### Advertisement (Sistema de Publicidad) - ‚úÖ IMPLEMENTADO
```php
// Campos clave
type (enum: 'sponsored_product', 'external_ad')
title, description (nullable)
image_url (requerido)
target_url (nullable) // URL destino al hacer click
is_active (boolean)
start_date (datetime)
end_date (datetime, nullable) // Si pasa, se desactiva autom√°ticamente
priority (int: orden de prioridad si hay m√∫ltiples)
clicks (int: contador de clicks)
impressions (int: contador de visualizaciones)
created_by (admin user_id)

// Campos espec√≠ficos por tipo
product_id (nullable, si type = 'sponsored_product')
advertiser_name (nullable, si type = 'external_ad')

// Relaciones
belongsTo(Product::class, 'product_id') // Si es sponsored_product
belongsTo(User::class, 'created_by') // Admin que crea

// L√≥gica de negocio
- Validaci√≥n autom√°tica de fechas: solo mostrar si is_active = true AND start_date <= NOW() AND (end_date IS NULL OR end_date >= NOW())
- Desactivaci√≥n autom√°tica cuando end_date pasa (se valida en cada consulta)
- Productos patrocinados pueden aparecer duplicados (como patrocinado y en listado normal)
- Modelo Unificado con Prioridad (similar a Instagram):
  * Alta prioridad (priority > 50): Aparecen primero, intercalados con productos (2-3 anuncios, luego 1-2 productos)
  * Baja prioridad (priority <= 50): Mezclados equitativamente con productos normales
  * Rotaci√≥n aleatoria dentro de cada nivel de prioridad (variaci√≥n ¬±20% en prioridad)
  * Cada refresh genera un orden diferente
- Solo admin puede crear/editar/eliminar anuncios (verificar con `auth()->user()->isAdmin()` o `auth()->user()->role === 'admin'`)
- Tracking: incrementar impressions al mostrar en frontend, clicks al hacer click
- Publicidad externa: al hacer click, redirige a target_url en navegador externo
```

**Tipos de publicidad:**
1. **sponsored_product**: Producto existente que se promociona pagando
   - Requiere `product_id` v√°lido
   - El producto debe estar activo (`status = 'active'`)
   - Se muestra como ProductCard con badge "Patrocinado"
   - Puede aparecer duplicado (patrocinado + listado normal)

2. **external_ad**: Publicidad de terceros (ej: Toyota, proveedores)
   - No requiere `product_id`
   - Requiere `advertiser_name` (nombre del anunciante)
   - `target_url` generalmente apunta a sitio externo
   - Se muestra como banner clickeable

**Posicionamiento - Modelo Unificado con Prioridad:**
- **Alta prioridad** (`priority > 50`): Aparecen primero, intercalados con productos normales
  - Intercalaci√≥n: 2-3 anuncios de alta prioridad, luego 1-2 productos normales/baja prioridad
  - Rotaci√≥n aleatoria dentro del grupo (variaci√≥n ¬±20% en prioridad para evitar orden fijo)
- **Baja prioridad** (`priority <= 50`): Mezclados equitativamente con productos normales
  - Shuffle aleatorio completo entre productos y anuncios de baja prioridad
- Rotaci√≥n aleatoria cada vez que se carga/refresca el marketplace
- No hay posiciones fijas (top/middle/bottom eliminadas)
- El frontend mezcla productos + anuncios seg√∫n prioridad y luego aplica rotaci√≥n aleatoria
- Publicidad externa: al hacer click, redirige a `target_url` en navegador externo

### Conversation (Chat)
```php
// Campos
profile_id_1, profile_id_2 (participantes)
product_id (opcional, si chat inici√≥ por producto)
ranch_id (opcional)
last_message_at, is_active

// Relaciones
hasMany(Message::class)
belongsTo(Profile::class, 'profile_id_1')
belongsTo(Profile::class, 'profile_id_2')

// L√≥gica
- Al enviar primer mensaje: crear Conversation
- Actualizar last_message_at en cada mensaje
```

### Message
```php
// Campos
conversation_id, sender_id
content (‚â§2000), message_type, attachment_url
read_at

// Relaciones
belongsTo(Conversation::class)
belongsTo(Profile::class, 'sender_id')

// L√≥gica
- Broadcast por WebSocket al guardar
- Marcar read_at al abrir conversaci√≥n
```

---

## ‚úÖ Validaciones (Backend)

### Productos
```php
$request->validate([
    'ranch_id' => 'required|exists:ranches,id',
    'title' => 'required|string|max:200',
    'description' => 'required|string|max:2000',
    'type' => 'required|in:cattle,equipment,feed,other',
    'breed' => 'required|string|max:100',
    'age_months' => 'nullable|integer|min:0|max:360',
    'quantity' => 'required|integer|min:1|max:10000',
    'price' => 'required|numeric|min:0',
    'currency' => 'required|in:USD,VES',
    'weight_avg_kg' => 'nullable|numeric|min:0|max:2000',
    'sex' => 'nullable|in:male,female,mixed',
    'purpose' => 'nullable|in:breeding,meat,dairy,mixed',
    'is_vaccinated' => 'nullable|boolean',
    'delivery_method' => 'required|in:pickup,delivery,both',
    'negotiable' => 'nullable|boolean',
    'status' => 'nullable|in:active,paused,sold,expired',
]);

// Validaci√≥n adicional: ownership
if ($ranch->profile_id !== auth()->user()->profile->id) {
    abort(403, 'No tienes permiso para publicar en esta hacienda');
}
```

### Perfiles
```php
$request->validate([
    'first_name' => 'nullable|string|max:100',
    'middle_name' => 'nullable|string|max:100',
    'last_name' => 'nullable|string|max:100',
    'second_last_name' => 'nullable|string|max:100',
    'bio' => 'nullable|string|max:500',  // ‚úÖ
    'date_of_birth' => 'nullable|date',
    'marital_status' => 'nullable|in:married,divorced,single',
    'sex' => 'nullable|in:F,M',
    'ci_number' => 'nullable|string|max:20',
    'accepts_calls' => 'nullable|boolean',
    'accepts_whatsapp' => 'nullable|boolean',
    'accepts_emails' => 'nullable|boolean',
    'whatsapp_number' => 'nullable|string|max:20',
]);
```

### Fotos de Perfil
```php
$request->validate([
    'photo_users' => 'required|image|mimes:jpeg,png,jpg|max:5120', // 5MB
]);

// Procesamiento
$path = $request->file('photo_users')->store('profile_images', 'public');
$photoUrl = config('app.url') . '/storage/' . $path;
```

### Haciendas
```php
$request->validate([
    'name' => 'required|string|max:200',
    'legal_name' => 'nullable|string|max:200',
    'tax_id' => 'nullable|string|max:50',
    'business_description' => 'nullable|string|max:1000',
    'is_primary' => 'nullable|boolean',
    // ... m√°s campos
]);

// Validaci√≥n DELETE
- No eliminar si tiene productos activos
- No eliminar la √∫nica hacienda
- Auto-promover otra si se elimina la primary
```

### Chat
```php
$request->validate([
    'content' => 'required|string|max:2000',
    'message_type' => 'nullable|in:text,image,video,document',
]);

// Validaci√≥n: usuario es participante
if (!in_array(auth()->user()->profile->id, [$conv->profile_id_1, $conv->profile_id_2])) {
    abort(403);
}
```

### Advertisements (Publicidad) - ‚úÖ IMPLEMENTADO
```php
// Validaci√≥n b√°sica
$request->validate([
    'type' => 'required|in:sponsored_product,external_ad',
    'title' => 'required|string|max:200',
    'description' => 'nullable|string|max:1000',
    'image_url' => 'required|url|max:500',
    'target_url' => 'nullable|url|max:500',
    'start_date' => 'required|date',
    'end_date' => 'nullable|date|after:start_date',
    'is_active' => 'nullable|boolean',
    'priority' => 'nullable|integer|min:0|max:100',
    // Campos espec√≠ficos por tipo
    'product_id' => 'required_if:type,sponsored_product|nullable|exists:products,id',
    'advertiser_name' => 'required_if:type,external_ad|nullable|string|max:200',
]);

// Validaci√≥n de admin
if (!auth()->user()->isAdmin()) {
    abort(403, 'Solo administradores pueden gestionar anuncios');
}

// Validaci√≥n espec√≠fica para sponsored_product
if ($request->type === 'sponsored_product') {
    $product = Product::find($request->product_id);
    if (!$product || $product->status !== 'active') {
        abort(422, 'El producto debe estar activo');
    }
}

// Validaci√≥n de fechas en consulta de anuncios activos
$advertisements = Advertisement::where('is_active', true)
    ->where('start_date', '<=', now())
    ->where(function($query) {
        $query->whereNull('end_date')
              ->orWhere('end_date', '>=', now());
    })
    ->get();
```

---

## üîê Pol√≠ticas de Acceso y Middleware

### Middleware Aplicados
```php
// Autenticaci√≥n (Sanctum)
Route::middleware('auth:sanctum')->group(function () {
    // Rutas protegidas
});

// Rate Limiting
Route::middleware('throttle:60,1')->group(...);  // Global
Route::middleware('throttle:30,1')->group(...);  // Chat
```

### Pol√≠ticas (Policies)
  ```php
// ProductPolicy
public function update(User $user, Product $product): bool {
    return $product->ranch->profile_id === $user->profile->id;
}

// RanchPolicy ‚úÖ
public function update(User $user, Ranch $ranch): bool {
    return $ranch->profile_id === $user->profile->id;
}

public function delete(User $user, Ranch $ranch): bool {
    // Verificar ownership
    // Verificar no tiene productos activos
    // Verificar no es la √∫nica hacienda
    return true;
}

// ConversationPolicy
public function view(User $user, Conversation $conversation): bool {
    return in_array($user->profile->id, [
        $conversation->profile_id_1,
        $conversation->profile_id_2
    ]);
}
```

---

## ‚úÖ Estado Actual MVP (Controladores y Endpoints)

### Controladores Activos
```
‚úÖ AuthController          (7 endpoints)
‚úÖ ProfileController        (8 endpoints)
‚úÖ RanchController          (5 endpoints) - CRUD completo ‚úÖ
‚úÖ ProductController        (5 endpoints)
‚úÖ ChatController           (6 endpoints)
‚úÖ FavoriteController
‚úÖ ReviewController
‚úÖ ReportController
```

### Endpoints Verificados (17/17) ‚úÖ

#### Auth
- POST `/api/auth/register`, `/api/auth/login`, `/api/auth/google`
- POST `/api/auth/logout` (auth)
- GET `/api/auth/user`, PUT `/api/auth/user`, PUT `/api/auth/password` (auth)

#### Profiles (auth)
- GET `/api/profile`, PUT `/api/profile`
- POST `/api/profile/photo` ‚úÖ (multipart dedicado)
- GET `/api/profiles/{id}` (p√∫blico)
- GET `/api/me/products`, `/api/me/ranches`, `/api/me/metrics`
- GET `/api/profiles/{id}/ranches` (p√∫blico)

#### Ranches (auth)
- GET `/api/ranches`, POST `/api/ranches`
- GET `/api/ranches/{id}`
- PUT `/api/ranches/{id}` ‚úÖ (ownership + validaciones)
- DELETE `/api/ranches/{id}` ‚úÖ (validaciones estrictas)

#### Products
- GET `/api/products` (p√∫blico con filtros), GET `/api/products/{id}`
- POST `/api/products` (auth), PUT `/api/products/{id}` (auth), DELETE `/api/products/{id}` (auth)

#### Advertisements (admin) - ‚úÖ IMPLEMENTADO
- GET    /api/advertisements              # Listar anuncios (admin)
- GET    /api/advertisements/active       # Obtener anuncios activos (p√∫blico, para marketplace)
- POST   /api/advertisements              # Crear anuncio (admin)
- GET    /api/advertisements/{id}         # Ver detalle (admin)
- PUT    /api/advertisements/{id}         # Actualizar (admin)
- DELETE /api/advertisements/{id}         # Eliminar (admin)
- POST   /api/advertisements/{id}/click   # Registrar click (p√∫blico, tracking)

**Nota:** El endpoint `/api/products` NO se modifica. El frontend hace 2 llamadas:
1. GET /api/products (productos normales - sin cambios)
2. GET /api/advertisements/active (anuncios activos)
3. Frontend mezcla seg√∫n Modelo Unificado con Prioridad:
   - Alta prioridad (priority > 50): Aparecen primero, intercalados (2-3 anuncios, luego 1-2 productos)
   - Baja prioridad (priority <= 50): Mezclados equitativamente con productos normales
   - Rotaci√≥n aleatoria dentro de cada nivel de prioridad

#### Chat (auth)
- GET `/api/chat/conversations`, POST `/api/chat/conversations`
- GET `/api/chat/conversations/{id}/messages`, POST `/api/chat/conversations/{id}/messages`
- POST `/api/chat/conversations/{id}/read`, DELETE `/api/chat/conversations/{id}`

---

## üß™ Testing - Estado Actual

### Tests Implementados: 27/27 (100% PASANDO)

#### ProfileApiTest.php (17 tests - 48 aserciones)
```php
‚úÖ can_get_my_profile_when_authenticated
‚úÖ cannot_get_profile_when_not_authenticated
‚úÖ returns_404_when_user_has_no_profile
‚úÖ can_update_my_profile
‚úÖ bio_cannot_exceed_500_characters  // ‚úÖ Bio validada
‚úÖ can_upload_profile_photo          // ‚úÖ Endpoint POST dedicado
‚úÖ photo_upload_requires_authentication
‚úÖ photo_must_be_valid_image
‚úÖ can_get_public_profile_by_id
‚úÖ returns_404_for_nonexistent_public_profile
‚úÖ can_get_my_products
‚úÖ my_products_returns_empty_array_when_no_products
‚úÖ can_get_my_ranches
‚úÖ can_get_my_metrics
‚úÖ metrics_returns_zeros_when_no_data
‚úÖ can_get_ranches_by_profile_id
‚úÖ ranches_by_profile_returns_empty_when_none
```

#### RanchApiTest.php (10 tests - 23 aserciones) ‚úÖ NUEVO
```php
‚úÖ can_update_my_ranch
‚úÖ cannot_update_ranch_i_do_not_own
‚úÖ update_requires_authentication
‚úÖ marking_ranch_as_primary_unmarks_others
‚úÖ can_delete_ranch_without_active_products
‚úÖ cannot_delete_ranch_with_active_products     // ‚úÖ Validaci√≥n cr√≠tica
‚úÖ cannot_delete_the_only_ranch                 // ‚úÖ Validaci√≥n cr√≠tica
‚úÖ cannot_delete_ranch_i_do_not_own
‚úÖ delete_requires_authentication
‚úÖ deleting_primary_ranch_promotes_another      // ‚úÖ Auto-promoci√≥n
```

### Ejecutar Tests
```bash
# Todos los tests
php artisan test

# Tests espec√≠ficos
php artisan test --filter=ProfileApiTest
php artisan test --filter=RanchApiTest

# Con cobertura
php artisan test --coverage
```

---

## üî• Features Implementados (MVP)

### 1. Sistema de Perfiles ‚úÖ 100%
**Funcionalidades completadas:**
- Ver perfil propio con toda la informaci√≥n
- Editar datos personales (nombres, bio, CI, preferencias)
- Subir foto de perfil (endpoint POST dedicado)
- Ver perfil p√∫blico de vendedores
- M√©tricas agregadas (productos, vistas, favoritos)
- Bio personalizada (‚â§500 caracteres)
- Email/WhatsApp visibles en perfil propio
- Verificaci√≥n con badge visual

**Tests:** 17/17 ‚úÖ

### 2. Sistema de Haciendas ‚úÖ 100% CRUD Completo
**Funcionalidades completadas:**
- Crear hacienda (onboarding)
- Ver mis haciendas
- Ver haciendas de vendedor (p√∫blico)
- **Actualizar hacienda (nombre, RIF, pol√≠ticas)** ‚úÖ NUEVO
- **Eliminar hacienda (con validaciones)** ‚úÖ NUEVO
- Auto-gesti√≥n de hacienda principal (is_primary)

**Validaciones cr√≠ticas:**
- ‚úÖ No eliminar hacienda con productos activos
- ‚úÖ No eliminar la √∫nica hacienda del perfil
- ‚úÖ Al eliminar primary, otra se marca autom√°ticamente
- ‚úÖ Al marcar como primary, las dem√°s se desmarcan
- ‚úÖ Ownership estricto (solo owner puede editar/eliminar)

**Tests:** 10/10 ‚úÖ

### 3. Sistema de Productos
**Funcionalidades:**
- Marketplace con filtros avanzados
- Detalle con incremento de vistas
- Crear producto (validaci√≥n de ownership del ranch)
- Actualizar producto
- Eliminar producto
- M√∫ltiples im√°genes (hasta 10)

**Validaciones:**
- Ranch debe pertenecer al usuario
- Enums validados (type, breed, sex, purpose, delivery_method, status)
- Ownership verificado en update/destroy

### 4. Sistema de Chat (1:1)
**Funcionalidades:**
- Conversaciones entre usuarios
- Mensajes con timestamps
- Marcar como le√≠do
- Contexto de producto/ranch (opcional)
- Rate-limit anti-spam

**Pendiente:**
- WebSocket en tiempo real (HTTP funcional)

### 5. Sistema de Publicidad (Marketplace) - ‚úÖ IMPLEMENTADO
**Funcionalidades:**
- Productos patrocinados (sponsored_product)
- Publicidad externa de terceros (external_ad)
- Modelo Unificado con Prioridad (similar a Instagram)
- Desactivaci√≥n autom√°tica por fecha de expiraci√≥n
- Tracking de clicks e impressions
- Gesti√≥n exclusiva por admin

**Validaciones:**
- Solo admin puede crear/editar/eliminar anuncios (usar `auth()->user()->isAdmin()` o verificar `role === 'admin'`)
- sponsored_product requiere product_id v√°lido y producto activo
- external_ad requiere advertiser_name
- Todos requieren image_url v√°lido
- Validaci√≥n autom√°tica de fechas (start_date, end_date)
- Si end_date pasa, anuncio se desactiva autom√°ticamente
- Campo priority (0-100) determina orden de aparici√≥n

**Verificaci√≥n de Admin:**
- Modelo User tiene m√©todo `isAdmin()`: `return $this->role === 'admin'`
- En controladores: `auth()->user()->isAdmin()` o `auth()->user()->role === 'admin'`
- Roles disponibles: 'admin', 'users', 'commerce', 'delivery'

**L√≥gica de negocio - Modelo Unificado con Prioridad:**
- **Alta prioridad** (`priority > 50`): Aparecen primero, intercalados con productos
  - Intercalaci√≥n: 2-3 anuncios de alta prioridad, luego 1-2 productos normales/baja prioridad
  - Rotaci√≥n aleatoria dentro del grupo (variaci√≥n ¬±20% en prioridad)
- **Baja prioridad** (`priority <= 50`): Mezclados equitativamente con productos normales
  - Shuffle aleatorio completo entre productos y anuncios de baja prioridad
- Productos patrocinados pueden aparecer duplicados (como producto normal y como anuncio patrocinado)
- Publicidad externa: al hacer click, redirige a `target_url` en navegador externo
- Validaci√≥n autom√°tica: solo mostrar anuncios activos y dentro de rango de fechas
- Cada refresh del marketplace genera un orden diferente
- Incrementar impressions al mostrar en frontend, clicks al hacer click
- El frontend hace 2 llamadas separadas y mezcla los resultados
- El endpoint `/api/products` se mantiene intacto (sin modificaciones)

---

## üîß Configuraci√≥n .env

### Variables Cr√≠ticas
```env
# App
APP_ENV=production
APP_DEBUG=false
APP_URL=http://192.168.27.12:8000           # ‚úÖ IP correcta
APP_URL_LOCAL=http://192.168.27.12:8000     # ‚úÖ Para desarrollo
APP_URL_PRODUCTION=https://backend.corralx.com

# Base de datos
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=corralx
DB_USERNAME=root
DB_PASSWORD=

# Storage
FILESYSTEM_DISK=public

# Sanctum
SANCTUM_STATEFUL_DOMAINS=localhost:3000,192.168.27.3
SESSION_DOMAIN=.corralx.com
```

**IMPORTANTE:** 
- `APP_URL` debe coincidir con la IP donde corre el servidor
- Usar `0.0.0.0` en `php artisan serve --host=0.0.0.0` para aceptar conexiones de red
- Verificar firewall permite puerto 8000

---

## üóÉÔ∏è Sistema de Ubicaciones Geogr√°ficas

### Datos Completos
- **Pa√≠ses:** 683 con c√≥digos ISO y prefijos telef√≥nicos
- **Estados:** 4,528 organizados por pa√≠s
- **Ciudades:** 47,123 organizadas por estado
- **Parroquias:** 436 (432 de Venezuela espec√≠ficamente)

### Venezuela
- **Estados:** 24 (IDs: 4020-4043)
- **Ciudades:** 117
- **Parroquias:** 432 organizadas por municipio
- **C√≥digos de operadora:** 30 c√≥digos venezolanos

### Uso
```php
// Selects anidados en frontend
Country ‚Üí State ‚Üí City ‚Üí Parish

// Seeders
CountriesSeeder, StatesSeeder, CitiesSeeder, ParishesSeeder
```

---

## üöÄ Comandos Operativos

### Desarrollo
```bash
# Migrar y poblar
php artisan migrate:fresh --seed --force

# Limpiar cach√©s
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Enlazar storage
php artisan storage:link

# Servidor de desarrollo
php artisan serve --host=0.0.0.0 --port=8000
```

### Producci√≥n
```bash
composer install --no-dev --optimize-autoloader
php artisan key:generate
php artisan migrate --force
php artisan storage:link
php artisan config:cache && php artisan route:cache && php artisan view:cache
```

### Tinker (Debugging)
```bash
# Actualizar URLs de im√°genes
php artisan tinker
>>> DB::table('profiles')->whereNotNull('photo_users')->update([
...   'photo_users' => DB::raw("REPLACE(photo_users, '192.168.27.11', '192.168.27.12')")
... ]);
```

---

## üêõ Bugs Resueltos (Historial)

### 1. Foto de Perfil No Se Guardaba
**Problema:** Laravel no procesa archivos multipart con PUT  
**Soluci√≥n:** Endpoint dedicado `POST /api/profile/photo`  
**Commit:** M√∫ltiples commits de correcci√≥n  
**Estado:** ‚úÖ Resuelto y testeado

### 2. URLs de Im√°genes Incorrectas
**Problema:** URLs guardadas con IP .11 en lugar de .12  
**Soluci√≥n:** Actualizar `.env` + comando Tinker para corregir BD  
**Estado:** ‚úÖ Resuelto

### 3. No Se Pod√≠a Eliminar Hacienda
**Problema:** Endpoint DELETE no exist√≠a  
**Soluci√≥n:** Implementar `RanchController@destroy` con validaciones  
**Tests:** 5 tests espec√≠ficos  
**Estado:** ‚úÖ Resuelto y testeado

---

## üìñ Convenciones de Commits

```
feat:     nueva funcionalidad
fix:      correcci√≥n de bug
test:     agregar o modificar tests
chore:    tareas de mantenimiento (build, deps)
docs:     cambios en documentaci√≥n
refactor: cambio interno sin afectar comportamiento
```

**Ejemplos:**
```bash
git commit -m "feat(ranches): Implementar UPDATE y DELETE con validaciones ‚úÖ"
git commit -m "fix(profiles): Corregir bug de foto de perfil üêõ"
git commit -m "test(ranches): Agregar 10 tests de CRUD completo ‚úÖ"
```

---

## üéØ Checklist MVP (Backend)

### Funcionalidades Core
- [x] Autenticaci√≥n (register, login, Google OAuth)
- [x] Perfiles (ver, editar, foto, bio, m√©tricas)
- [x] Haciendas (CRUD completo con validaciones)
- [x] Productos (CRUD completo)
- [x] Chat (HTTP funcional, WebSocket en desarrollo)
- [x] Favoritos y Rese√±as
- [x] Sistema de reportes

### Calidad
- [x] 27 tests automatizados (100% pasando)
- [x] Validaciones robustas
- [x] Manejo de errores
- [x] Pol√≠ticas de autorizaci√≥n
- [x] 0 bugs cr√≠ticos
- [x] C√≥digo limpio (PSR-12)
- [x] Documentaci√≥n completa

### Infraestructura
- [x] Migraciones ejecutadas
- [x] Seeders con datos reales
- [x] Storage configurado
- [x] .env configurado
- [x] Servidor corriendo (0.0.0.0:8000)

---

## üö¢ Despliegue

### Hosting Compartido
1. Subir archivos (excepto `vendor/`, `node_modules/`)
2. `composer install --no-dev --optimize-autoloader`
3. Configurar `.env` con datos de producci√≥n
4. `php artisan migrate --force`
5. `php artisan storage:link`
6. `php artisan config:cache`
7. Permisos: `chmod -R 775 storage bootstrap/cache`
8. Configurar Apache/Nginx para apuntar a `public/`

### Servidor Dedicado
- PHP-FPM para mejor performance
- Supervisor para queues (opcional)
- Laravel Echo Server para WebSockets
- SSL con Let's Encrypt
- MySQL optimizado

---

## üìä M√©tricas de Calidad

### Tests
```
ProfileApiTest: 17/17 tests (48 aserciones) ‚úÖ
RanchApiTest:   10/10 tests (23 aserciones) ‚úÖ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
TOTAL:          27/27 tests (100% PASANDO) ‚úÖ
Duraci√≥n:       ~2.8s
```

### Cobertura de Funcionalidades
```
Auth:         100% ‚úÖ
Perfiles:     100% ‚úÖ
Haciendas:    100% ‚úÖ (CRUD completo)
Productos:    100% ‚úÖ
Chat:         90% (falta WebSocket)
Favoritos:    100% ‚úÖ
Rese√±as:      100% ‚úÖ
```

### C√≥digo
- **Controladores:** 8 activos
- **Modelos:** 21 con relaciones
- **Migraciones:** 28 ejecutadas
- **Factories:** 18 con datos reales
- **Seeders:** 12 completos
- **Tests:** 27 automatizados

---

## üîÆ Roadmap (Post-MVP)

### Corto Plazo
- [ ] WebSockets para chat en tiempo real
- [ ] Panel de administraci√≥n completo
- [ ] Sistema de verificaci√≥n avanzado
- [ ] Notificaciones push

### Mediano Plazo
- [ ] Pagos integrados (escrow)
- [ ] Comisiones por transacci√≥n
- [ ] Suscripci√≥n Premium
- [ ] Anal√≠tica de mercado (precios, tendencias)

### Largo Plazo
- [ ] Integraci√≥n con sistemas de trazabilidad
- [ ] Marketplace de equipos y alimentos
- [ ] Expansi√≥n internacional
- [ ] API p√∫blica para terceros

---

## üìù Notas Importantes

### Storage de Im√°genes
```bash
# Enlace simb√≥lico
php artisan storage:link

# Ubicaci√≥n f√≠sica
storage/app/public/profile_images/
storage/app/public/product_images/

# URL accesible
http://TU_IP:8000/storage/profile_images/archivo.jpg
```

### Servidor de Desarrollo
```bash
# Escuchar en todas las interfaces (accesible desde red local)
php artisan serve --host=0.0.0.0 --port=8000

# Solo localhost
php artisan serve
```

### Base de Datos
```bash
# Reset completo con datos de prueba
php artisan migrate:fresh --seed --force

# Solo migraciones
php artisan migrate --force

# Rollback
php artisan migrate:rollback
```

---

## üéØ KPIs de √âxito

Para medir el √©xito del MVP, trackear:
- Usuarios registrados activos/mes
- Publicaciones activas
- Conversaciones iniciadas
- Tasa de respuesta en chats
- % publicaciones con al menos 1 conversaci√≥n
- Retenci√≥n a 30 d√≠as
- Rating promedio de vendedores

---

## üèÜ Logros del MVP

### T√©cnicos
- ‚úÖ 27 tests automatizados (100% pasando)
- ‚úÖ CRUD completo de 3 entidades principales
- ‚úÖ Sistema de ubicaciones con 47K+ ciudades
- ‚úÖ 0 bugs cr√≠ticos
- ‚úÖ Arquitectura escalable

### Funcionales
- ‚úÖ 11 funcionalidades de perfiles operativas
- ‚úÖ Validaciones robustas en ambos lados
- ‚úÖ Manejo de errores completo
- ‚úÖ API RESTful bien dise√±ada

### Documentaci√≥n
- ‚úÖ README completo
- ‚úÖ .cursorrules actualizado
- ‚úÖ C√≥digo bien comentado
- ‚úÖ Tests como documentaci√≥n viva

---

**Preparado por:** Equipo CorralX  
**Versi√≥n:** 1.0.0 (MVP)  
**Estado:** ‚úÖ Production-Ready  
**Calidad:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
